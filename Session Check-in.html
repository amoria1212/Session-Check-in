<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Sign-In Sheet - Collaborating Wellness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background-color: #f4f0ed; /* Dusty background */
            color: #374151;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Cormorant Garamond', serif;
        }
        
        .section-header {
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .section-header::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: #D1D5DB; /* Light Gray-Silver accent */
            border-radius: 9999px;
        }
        
        .journal-box {
            background-color: #f0e8e6; /* Pale Rose background */
            border-left: 4px solid #D1D5DB; /* Light Gray-Silver accent */
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .journal-input {
            width: 100%;
            min-height: 3rem;
            border: 1px solid #d1d5db;
            background-color: #fff;
            padding: 0.5rem;
            border-radius: 0.375rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }
        
        .journal-input:focus {
            outline: none;
            border-color: #D1D5DB;
            box-shadow: 0 0 0 3px rgba(209, 213, 219, 0.5);
        }
        
        .btn {
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .info-box {
            background: #fdfae9;
            border: 1px solid #e6d8a2;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .save-indicator.show { opacity: 1; }
        .save-indicator.saved {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .save-indicator.saving {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .save-indicator.error {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }
        .save-indicator.success {
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }

        .share-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .share-modal.show {
            opacity: 1;
            visibility: visible;
        }
        .share-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .share-option {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        .share-option:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .share-option .icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            min-width: 2rem;
        }
        .share-option .content { flex: 1; }
        .share-option .title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .share-option .description {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .feelings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.5rem;
        }
        
        .feeling-item {
            display: flex;
            align-items: center;
            padding: 0.25rem;
            font-size: 0.9rem;
        }
        
        .feeling-item input[type="checkbox"] {
            margin-right: 0.5rem;
            accent-color: #D1D5DB; /* Leaning on silver more here */
        }
        
        .brand-logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .brand-logo h1 {
            color: #374151;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .brand-subtitle {
            color: #6B7280;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .journal-box { background-color: #f9f9f9; }
        }
    </style>
</head>
<body>

    <div id="saveIndicator" class="save-indicator">
        <span id="saveText">Auto-saving...</span>
    </div>

    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Share Your Responses</h3>
                <button onclick="closeShareModal()" class="text-gray-500 hover:text-gray-700 text-2xl close-button">&times;</button>
            </div>
            <p class="text-gray-600 mb-4">Choose how you'd like to share your responses:</p>
            
            <div class="space-y-3">
                <button onclick="shareViaEmail()" class="share-option" style="background-color: #EFF6FF; color: #1D4ED8;">
                    <span class="icon">üìß</span>
                    <div class="content">
                        <div class="title">Email</div>
                        <div class="description">Send via your email client</div>
                    </div>
                </button>
                
                <button onclick="copyToClipboard()" class="share-option" style="background-color: #F0FDF4; color: #15803D;">
                    <span class="icon">üìã</span>
                    <div class="content">
                        <div class="title">Copy to Clipboard</div>
                        <div class="description">Copy text to paste anywhere</div>
                    </div>
                </button>
                
                <button onclick="shareViaWebAPI()" class="share-option" id="webShareButton" style="background-color: #FAF5FF; color: #7C3AED; display: none;">
                    <span class="icon">üîó</span>
                    <div class="content">
                        <div class="title">Share</div>
                        <div class="description">Use device sharing options</div>
                    </div>
                </button>
                
                <button onclick="downloadFile()" class="share-option" style="background-color: #FFF7ED; color: #C2410C;">
                    <span class="icon">üíæ</span>
                    <div class="content">
                        <div class="title">Download File</div>
                        <div class="description">Save as text file</div>
                    </div>
                </button>
            </div>
            
            <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                <p class="text-sm text-yellow-700">
                    <strong>Privacy Note:</strong> Your responses contain personal information. Share thoughtfully.
                </p>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8 my-6">
        
        <div class="brand-logo">
            <img src="https://i.imgur.com/JwAdvDd.png" alt="Janice LaFountaine, MS, LMFT Logo" class="h-24 w-auto mx-auto rounded-full shadow-md">
            <p class="brand-subtitle mt-2">Janice LaFountaine, MS, LMFT</p>
        </div>

        <div class="no-print flex flex-wrap gap-3 mb-6 justify-end">
            <button onclick="openShareModal()" class="btn px-4 py-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 transition-colors text-sm font-medium">
                üîó Share
            </button>
            <button onclick="exportData()" class="btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium">
                üì• Export Responses
            </button>
            <button onclick="clearData()" class="btn px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium">
                üóëÔ∏è Clear All
            </button>
            <button onclick="window.print()" class="btn px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">
                üñ®Ô∏è Print
            </button>
        </div>

        <header class="mb-8">
            <h2 class="section-header text-3xl font-bold text-gray-800 mb-4">Session Sign-In Sheet</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date:</label>
                    <input type="date" data-key="session-date" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Session Time:</label>
                    <input type="time" data-key="session-time" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Client Name:</label>
                <input type="text" data-key="client-name" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" placeholder="Your name">
            </div>
        </header>

        <div class="journal-box">
            <h3 class="section-header text-xl font-semibold mb-4">How Are You Feeling Today?</h3>
            <p class="text-sm text-gray-600 mb-4">Please check all emotions that apply to how you're feeling right now:</p>
            
            <div class="feelings-grid">
                <div class="feeling-item"><input type="checkbox" data-key="feeling-affectionate"> Affectionate</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-alert"> Alert</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-alive"> Alive</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-angry"> Angry</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-anxious"> Anxious</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-appreciative"> Appreciative</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-ashamed"> Ashamed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-brave"> Brave</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-calm"> Calm</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-capable"> Capable</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-caring"> Caring</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-centered"> Centered</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-compassionate"> Compassionate</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-confident"> Confident</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-confused"> Confused</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-connected"> Connected</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-content"> Content</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-curious"> Curious</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-defeated"> Defeated</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-depressed"> Depressed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-determined"> Determined</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-disappointed"> Disappointed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-disconnected"> Disconnected</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-discouraged"> Discouraged</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-embarrassed"> Embarrassed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-empowered"> Empowered</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-empty"> Empty</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-energized"> Energized</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-engaged"> Engaged</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-excited"> Excited</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-fearful"> Fearful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-focused"> Focused</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-frustrated"> Frustrated</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-grateful"> Grateful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-grieving"> Grieving</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-grounded"> Grounded</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-guilty"> Guilty</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-happy"> Happy</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-heartbroken"> Heartbroken</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-heavy"> Heavy</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-helpless"> Helpless</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-hopeful"> Hopeful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-hopeless"> Hopeless</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-hurt"> Hurt</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-inspired"> Inspired</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-irritated"> Irritated</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-isolated"> Isolated</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-joyful"> Joyful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-light"> Light</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-lonely"> Lonely</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-loved"> Loved</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-motivated"> Motivated</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-nervous"> Nervous</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-numb"> Numb</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-optimistic"> Optimistic</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-overwhelmed"> Overwhelmed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-panicked"> Panicked</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-peaceful"> Peaceful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-powerless"> Powerless</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-present"> Present</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-proud"> Proud</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-relaxed"> Relaxed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-resentful"> Resentful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-sad"> Sad</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-safe"> Safe</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-scared"> Scared</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-serene"> Serene</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-stressed"> Stressed</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-strong"> Strong</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-stuck"> Stuck</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-supported"> Supported</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-tense"> Tense</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-thankful"> Thankful</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-tired"> Tired</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-trapped"> Trapped</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-trusting"> Trusting</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-upset"> Upset</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-vulnerable"> Vulnerable</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-warm"> Warm</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-worried"> Worried</div>
                <div class="feeling-item"><input type="checkbox" data-key="feeling-worthy"> Worthy</div>
            </div>
            
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Other feelings not listed:</label>
                <textarea data-key="other-feelings" class="journal-input" rows="2" placeholder="Describe any other feelings..."></textarea>
            </div>
        </div>

        <div class="journal-box">
            <h3 class="section-header text-xl font-semibold mb-4">Goal Progress Since Last Session</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">What have you accomplished toward your therapy goals since our last meeting?</label>
                <p class="text-sm text-gray-500 mb-2 italic">Examples: practiced breathing techniques, had a difficult conversation, noticed negative thought patterns, used coping strategies, etc.</p>
                <textarea data-key="goal-progress" class="journal-input" rows="4" placeholder="Describe your progress..."></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">What are you most proud of since our last session?</label>
                <textarea data-key="proud-of" class="journal-input" rows="3" placeholder="Share what you're proud of..."></textarea>
            </div>
        </div>

        <div class="journal-box">
            <h3 class="section-header text-xl font-semibold mb-4">Challenges and Session Focus</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">What challenges have you faced since our last session?</label>
                <textarea data-key="challenges" class="journal-input" rows="3" placeholder="Describe any challenges..."></textarea>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">What would you like to focus on or discuss in today's session?</label>
                <textarea data-key="session-focus" class="journal-input" rows="3" placeholder="What would you like to discuss today?"></textarea>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Are there any specific situations, memories, or triggers you'd like to address today? (Potential EMDR targets)</label>
                <textarea data-key="emdr-targets" class="journal-input" rows="3" placeholder="Describe any specific memories or triggers..."></textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Current stress level (1-10, with 10 being highest):</label>
                    <select data-key="stress-level" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300">
                        <option value="">Select level</option>
                        <option value="1">1 - Very Low</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 - Moderate</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10 - Very High</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Current anxiety level (1-10, with 10 being highest):</label>
                    <select data-key="anxiety-level" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300">
                        <option value="">Select level</option>
                        <option value="1">1 - Very Low</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 - Moderate</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10 - Very High</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="journal-box">
            <h3 class="section-header text-xl font-semibold mb-4">Additional Notes</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Is there anything else you would like me to know?</label>
                <textarea data-key="additional-notes" class="journal-input" rows="3" placeholder="Share any additional thoughts or concerns..."></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Any changes in medications, sleep patterns, or major life events?</label>
                <textarea data-key="life-changes" class="journal-input" rows="3" placeholder="Describe any changes..."></textarea>
            </div>
        </div>

        <div class="info-box mt-8 text-center">
            <p class="text-sm text-gray-600 italic">Thank you for taking the time to complete this form. This information helps us make the most of our session together.</p>
        </div>
    </div>

    <script>
        // GLOBAL VARIABLES - MUST BE ACCESSIBLE TO onclick HANDLERS
        var saveTimeout;
        var saveIndicator;
        var saveText;

        // GLOBAL FUNCTIONS - CRITICAL: Must be in window scope for onclick to work
        function openShareModal() {
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        function showSaveIndicator(status) {
            saveIndicator.className = 'save-indicator show ' + status;
            var messages = {
                saving: 'Auto-saving...',
                saved: '‚úì Saved',
                success: '‚úì Success',
                error: '‚úó Error'
            };
            saveText.textContent = messages[status] || status;
        }

        function hideSaveIndicator() {
            saveIndicator.classList.remove('show');
        }

        function saveData(element) {
            var key = element.getAttribute('data-key');
            if (element.type === 'checkbox') {
                localStorage.setItem(key, element.checked);
            } else {
                localStorage.setItem(key, element.value);
            }
        }

        function loadSavedData() {
            var elements = document.querySelectorAll('textarea[data-key], input[data-key], select[data-key]');
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                var key = element.getAttribute('data-key');
                var saved = localStorage.getItem(key);
                if (saved !== null) {
                    if (element.type === 'checkbox') {
                        element.checked = saved === 'true';
                    } else {
                        element.value = saved;
                    }
                }
            }
        }

        function collectAllData() {
            var data = {};
            var elements = document.querySelectorAll('textarea[data-key], input[data-key], select[data-key]');
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                var key = element.getAttribute('data-key');
                var value;
                
                if (element.type === 'checkbox') {
                    value = element.checked;
                } else {
                    value = element.value.trim();
                }
                
                if (value) {
                    data[key] = value;
                }
            }
            return data;
        }

        function formatDataForSharing() {
            var data = collectAllData();
            var date = new Date().toLocaleDateString();
            
            var shareText = 'SESSION SIGN-IN SHEET - COLLABORATING WELLNESS\n';
            shareText += 'Date: ' + date + '\n';
            shareText += 'Therapist: Janice LaFountaine, MS, LMFT\n';
            shareText += '============================================================\n\n';

            // Client Information
            if (data['client-name'] || data['session-date'] || data['session-time']) {
                shareText += 'CLIENT INFORMATION\n';
                shareText += '------------------\n';
                if (data['client-name']) shareText += 'Name: ' + data['client-name'] + '\n';
                if (data['session-date']) shareText += 'Session Date: ' + data['session-date'] + '\n';
                if (data['session-time']) shareText += 'Session Time: ' + data['session-time'] + '\n';
                shareText += '\n';
            }

            // Feelings
            var feelings = [];
            for (var key in data) {
                if (key.indexOf('feeling-') === 0 && data[key] === true) {
                    var formattedFeeling = key.replace('feeling-', '').replace(/-/g, ' ');
                    feelings.push(formattedFeeling.charAt(0).toUpperCase() + formattedFeeling.slice(1));
                }
            }
            
            if (feelings.length > 0 || data['other-feelings']) {
                shareText += 'CURRENT FEELINGS\n';
                shareText += '----------------\n';
                if (feelings.length > 0) {
                    shareText += 'Selected feelings: ' + feelings.join(', ') + '\n';
                }
                if (data['other-feelings']) {
                    shareText += 'Other feelings: ' + data['other-feelings'] + '\n';
                }
                shareText += '\n';
            }

            // Goal Progress
            if (data['goal-progress'] || data['proud-of']) {
                shareText += 'GOAL PROGRESS\n';
                shareText += '-------------\n';
                if (data['goal-progress']) {
                    shareText += 'Accomplishments: ' + data['goal-progress'] + '\n\n';
                }
                if (data['proud-of']) {
                    shareText += 'Most proud of: ' + data['proud-of'] + '\n\n';
                }
            }

            // Challenges and Focus
            if (data['challenges'] || data['session-focus'] || data['emdr-targets'] || data['stress-level'] || data['anxiety-level']) {
                shareText += 'CHALLENGES & SESSION FOCUS\n';
                shareText += '--------------------------\n';
                if (data['challenges']) {
                    shareText += 'Challenges: ' + data['challenges'] + '\n\n';
                }
                if (data['session-focus']) {
                    shareText += 'Session focus: ' + data['session-focus'] + '\n\n';
                }
                if (data['emdr-targets']) {
                    shareText += 'EMDR targets: ' + data['emdr-targets'] + '\n\n';
                }
                if (data['stress-level']) {
                    shareText += 'Stress level: ' + data['stress-level'] + '/10\n';
                }
                if (data['anxiety-level']) {
                    shareText += 'Anxiety level: ' + data['anxiety-level'] + '/10\n';
                }
                shareText += '\n';
            }

            // Additional Notes
            if (data['additional-notes'] || data['life-changes']) {
                shareText += 'ADDITIONAL NOTES\n';
                shareText += '----------------\n';
                if (data['additional-notes']) {
                    shareText += 'Notes: ' + data['additional-notes'] + '\n\n';
                }
                if (data['life-changes']) {
                    shareText += 'Life changes: ' + data['life-changes'] + '\n\n';
                }
            }

            shareText += '============================================================\n';
            shareText += 'Generated: ' + date;
            
            return shareText;
        }

        function shareViaEmail() {
            try {
                var shareText = formatDataForSharing();
                var subject = encodeURIComponent('Session Sign-In Sheet Responses');
                var body = encodeURIComponent(shareText);
                var mailtoLink = 'mailto:?subject=' + subject + '&body=' + body;
                
                window.location.href = mailtoLink;
                closeShareModal();
                
                showSaveIndicator('success');
                setTimeout(function() { hideSaveIndicator(); }, 2000);
            } catch (error) {
                console.error('Email error:', error);
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
        }

        function copyToClipboard() {
            try {
                var shareText = formatDataForSharing();
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareText).then(function() {
                        closeShareModal();
                        showSaveIndicator('success');
                        setTimeout(function() { hideSaveIndicator(); }, 2000);
                    }).catch(function(error) {
                        console.error('Copy error:', error);
                        fallbackCopy(shareText);
                    });
                } else {
                    fallbackCopy(shareText);
                }
            } catch (error) {
                console.error('Copy error:', error);
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                closeShareModal();
                showSaveIndicator('success');
                setTimeout(function() { hideSaveIndicator(); }, 2000);
            } catch (error) {
                console.error('Fallback copy failed:', error);
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
            document.body.removeChild(textArea);
        }

        function shareViaWebAPI() {
            if (!navigator.share) {
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
                return;
            }

            try {
                var shareText = formatDataForSharing();
                
                navigator.share({
                    title: 'Session Sign-In Sheet Responses',
                    text: shareText
                }).then(function() {
                    closeShareModal();
                    showSaveIndicator('success');
                    setTimeout(function() { hideSaveIndicator(); }, 2000);
                }).catch(function(error) {
                    if (error.name !== 'AbortError') {
                        console.error('Share error:', error);
                        showSaveIndicator('error');
                        setTimeout(function() { hideSaveIndicator(); }, 3000);
                    }
                    closeShareModal();
                });
            } catch (error) {
                console.error('Share error:', error);
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
        }

        function downloadFile() {
            try {
                var shareText = formatDataForSharing();
                var date = new Date().toISOString().split('T')[0];
                
                var blob = new Blob([shareText], { type: 'text/plain;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'session-signin-responses-' + date + '.txt';
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                closeShareModal();
                showSaveIndicator('success');
                setTimeout(function() { hideSaveIndicator(); }, 2000);
            } catch (error) {
                console.error('Download error:', error);
                closeShareModal();
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
        }

        function exportData() {
            try {
                var exportText = formatDataForSharing();
                var date = new Date().toISOString().split('T')[0];
                
                var blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'session-signin-' + date + '.txt';
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showSaveIndicator('success');
                setTimeout(function() { hideSaveIndicator(); }, 2000);
            } catch (error) {
                console.error('Export error:', error);
                showSaveIndicator('error');
                setTimeout(function() { hideSaveIndicator(); }, 3000);
            }
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all responses? This cannot be undone.')) {
                var elements = document.querySelectorAll('[data-key]');
                for (var i = 0; i < elements.length; i++) {
                    var element = elements[i];
                    var key = element.getAttribute('data-key');
                    localStorage.removeItem(key);
                    
                    if (element.type === 'checkbox') {
                        element.checked = false;
                    } else {
                        element.value = '';
                    }
                }
                
                showSaveIndicator('success');
                setTimeout(function() { hideSaveIndicator(); }, 2000);
            }
        }

        // INITIALIZATION - Use old-style JS for maximum compatibility
        document.addEventListener('DOMContentLoaded', function() {
            saveIndicator = document.getElementById('saveIndicator');
            saveText = document.getElementById('saveText');
            
            loadSavedData();
            
            if (navigator.share) {
                document.getElementById('webShareButton').style.display = 'block';
            }
            
            // Close modal on escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeShareModal();
            });
            
            // Close modal on backdrop click
            document.getElementById('shareModal').addEventListener('click', function(e) {
                if (e.target === this) closeShareModal();
            });
        });

        // AUTO-SAVE
        document.addEventListener('input', function(e) {
            if (e.target.matches && e.target.matches('textarea[data-key], input[data-key], select[data-key]')) {
                showSaveIndicator('saving');
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(function() {
                    saveData(e.target);
                    showSaveIndicator('saved');
                    setTimeout(function() { hideSaveIndicator(); }, 2000);
                }, 500);
            }
        });

        document.addEventListener('change', function(e) {
            if (e.target.matches && e.target.matches('input[type="checkbox"][data-key]')) {
                showSaveIndicator('saving');
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(function() {
                    saveData(e.target);
                    showSaveIndicator('saved');
                    setTimeout(function() { hideSaveIndicator(); }, 2000);
                }, 500);
            }
        });
    </script>

</body>
</html>
